<project default="java:jar" xmlns:j="jelly:core" xmlns:define="jelly:define">
	<!-- ================================================================  -->
	<!-- Deploy                                                                                        -->
	<!-- ================================================================ -->
	<goal name="deploy">
		<echo message="Deploy portal war into ${org.apache.jetspeed.deploy.war.dir}"/>
		<!-- j:set var="maven.build.dir" value="./target" />
		<j:set var="maven.war.final.name" value="${pom.artifactId}.war" />
		<attainGoal name="jetspeed2:deploy" / -->
		
		<copy todir="${org.apache.jetspeed.deploy.war.dir}" file="${maven.build.dir}/${maven.war.final.name}" overwrite="true"/>		
	</goal>	
	
	<preGoal name="deploy">
		<attainGoal name= "war:install"/>
	</preGoal>
	
	<postGoal name="war:webapp">

    <j:forEach var="lib" items="${pom.artifacts}">
      <j:set var="dep" value="${lib.dependency}"/>     
      <j:if test="${lib.artifactId==''}">
          
         <j:if test="${dep.type =='jar'}"> 
           <ant:copy todir="${webapp.build.lib}" file="${lib.path}"/>  
         </j:if> 
         
         <j:if test="${dep.type =='tld'}"> 
           <ant:copy todir="${webapp.build.tlds}" file="${lib.path}"/>  
         </j:if> 
          
      </j:if>  
      <!-- TO BE REMOVED -->
      <j:if test="${dep.getProperty('war.bundle.jar')=='true'}">
         <ant:echo> 
            DEPRECATION WARNING:            
            Use : war.bundle instead of war.bundle.jar
          </ant:echo>
        <ant:copy todir="${webapp.build.lib}" file="${lib.path}"/>
      </j:if>  
      <!-- END OF TO BE REMOVED -->

      <j:set var="targetPath" value="${dep.getProperty('war.target.path')}"/> 
      <j:if test="${!empty(targetPath)}">
        <ant:copy todir="${maven.war.webapp.dir}/${targetPath}" file="${lib.path}"/>
      </j:if>
    </j:forEach>             
	
		<copy file="${basedir}/webapp/META-INF/context.xml"
            tofile="${maven.war.webapp.dir}/META-INF/context.xml"
            overwrite="true"
            failonerror="true">
      </copy>
	</postGoal>
	
	<goal name="undeploy">
		<echo message="Undeploy ${org.apache.jetspeed.deploy.war.dir}/${pom.artifactId}.war"/>
		<delete file="${org.apache.jetspeed.deploy.war.dir}/${pom.artifactId}.war"/>
	</goal>
	
	<!-- ================================================================ -->
	<!-- Hot Deploy for mundane everyday development under Catalina       -->
	<!-- ================================================================ -->
	<!-- TODO -->
	<goal name="hotdeploy">
		<echo message="Hot Deploying ${org.apache.jetspeed.portlet.app.name} to ${org.apache.jetspeed.deploy.war.dir}"/>
		<copy todir="${org.apache.jetspeed.deploy.war.dir}/${org.apache.jetspeed.portlet.app.name}/WEB-INF/classes">
			<fileset dir="${maven.build.dir}/classes">
			</fileset>
		</copy>
		<copy todir="${org.apache.jetspeed.deploy.war.dir}/${org.apache.jetspeed.portlet.app.name}/">
			<fileset dir="./src/webapp">
			</fileset>
		</copy>
	</goal>
	<preGoal name="hotdeploy">
		<attainGoal name= "java:compile"/>
	</preGoal>
</project>