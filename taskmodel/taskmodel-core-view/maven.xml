<project default="java:jar" xmlns:j="jelly:core" xmlns:define="jelly:define">
	<!-- ================================================================  -->
	<!-- Deploy                                                                                        -->
	<!-- ================================================================ -->
	<goal name="deploy">
		<echo message="Deploy portal war into ${org.apache.jetspeed.deploy.war.dir}"/>
		<!-- j:set var="maven.build.dir" value="./target" />
		<j:set var="maven.war.final.name" value="${pom.artifactId}.war" />
		<attainGoal name="jetspeed2:deploy" / -->
		
		<copy todir="${org.apache.jetspeed.deploy.war.dir}" file="${maven.build.dir}/${maven.war.final.name}" overwrite="true"/>		
	</goal>	
	
	<preGoal name="deploy">
		<attainGoal name= "war:install"/>
	</preGoal>
	
	<!-- copy the drawtask jar to webapps/drawTask -->
	<postGoal name="war:webapp">

	    <j:forEach var="lib" items="${pom.artifacts}">
	      <j:set var="dep" value="${lib.dependency}"/>
	      <j:if test="${dep.artifactId=='drawtask'}">
	          
	         <j:if test="${dep.type =='jar'}"> 
	           <copy todir="${maven.war.webapp.dir}/drawTask" file="${lib.path}"/>  
	         </j:if> 
	          
	      </j:if>  
	
	    </j:forEach>             
		
	</postGoal>
	
	<goal name="undeploy">
		<echo message="Undeploy ${org.apache.jetspeed.deploy.war.dir}/${pom.artifactId}.war"/>
		<delete file="${org.apache.jetspeed.deploy.war.dir}/${pom.artifactId}.war"/>
	</goal>
	
	<!-- ================================================================ -->
	<!-- Hot Deploy for mundane everyday development under Catalina       -->
	<!-- ================================================================ -->
	<!-- TODO -->
	<goal name="hotdeploy">
		<echo message="Hot Deploying ${org.apache.jetspeed.portlet.app.name} to ${org.apache.jetspeed.deploy.war.dir}"/>
		<copy todir="${org.apache.jetspeed.deploy.war.dir}/${org.apache.jetspeed.portlet.app.name}/WEB-INF/classes">
			<fileset dir="${maven.build.dir}/classes">
			</fileset>
		</copy>
		<copy todir="${org.apache.jetspeed.deploy.war.dir}/${org.apache.jetspeed.portlet.app.name}/">
			<fileset dir="./src/webapp">
			</fileset>
		</copy>
	</goal>
	<preGoal name="hotdeploy">
		<attainGoal name= "java:compile"/>
	</preGoal>
</project>